# OpenAPI Schema for SakuraFrp API v4

openapi: 3.0.3
info:
  title: SakuraFrp API
  version: 4.1.0
  termsOfService: "https://www.natfrp.com/policy/tos"
  license:
    name: GNU Affero General Public License v3.0
    url: "https://www.gnu.org/licenses/agpl-3.0.en.html"
  contact:
    name: SakuraFrp Support
    email: support@natfrp.cloud

servers:
  - url: "https://api.natfrp.com/v4"
    description: SakuraFrp API

paths:
  /system/bulletin:
    get:
      tags: [ç³»ç»Ÿä¿¡æ¯]
      summary: è·å–å¹³å°å…¬å‘Š
      security: []
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - title
                    - content
                    - icon
                    - time
                    - expand
                  properties:
                    title:
                      type: string
                      description: å…¬å‘Šæ ‡é¢˜
                      example: å…³äº SakuraFrp API çš„è¯´æ˜
                    content:
                      type: string
                      description: å…¬å‘Šå†…å®¹
                      example: Lorem ipsum dolor sit amet, consectetur adipiscing elit
                    time:
                      type: string
                      description: å…¬å‘Šå‘å¸ƒæ—¶é—´
                      example: 2023/01/01
                    icon:
                      type: string
                      description: å…¬å‘Šå›¾æ ‡
                      example: ğŸ˜Š
                    expand:
                      type: boolean
                      description: æ˜¯å¦é»˜è®¤å±•å¼€
                      example: true
          description: è¿”å›å¹³å°å…¬å‘Šåˆ—è¡¨
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /system/download:
    get:
      tags: [ç³»ç»Ÿä¿¡æ¯]
      summary: è·å–è½¯ä»¶ä¸‹è½½ä¿¡æ¯
      security: []
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: object
                    description: ç‰ˆæœ¬ä¿¡æ¯
                    properties:
                      launcher:
                        type: object
                        description: å¯åŠ¨å™¨ç‰ˆæœ¬ä¿¡æ¯
                        properties:
                          time:
                            type: integer
                            description: ç‰ˆæœ¬å‘å¸ƒæ—¶é—´
                            example: 1620000000
                          version:
                            type: string
                            description: ç‰ˆæœ¬å·
                            example: 2.0.6.0
                          note:
                            type: string
                            description: æ›´æ–°æ—¥å¿—
                            example: Ut aliquam purus sit amet luctus venenatis lectus magna fringilla
                      frpc:
                        type: object
                        description: å®¢æˆ·ç«¯ç‰ˆæœ¬ä¿¡æ¯
                        properties:
                          time:
                            type: integer
                            description: ç‰ˆæœ¬å‘å¸ƒæ—¶é—´
                            example: 1620000000
                          version:
                            type: string
                            description: ç‰ˆæœ¬å·
                            example: 0.45.0-sakura-2
                          note:
                            type: string
                            description: æ›´æ–°æ—¥å¿—
                            example: Tristique senectus et netus et malesuada fames
                  downloads:
                    type: object
                    description: ä¸‹è½½åˆ†ç±»
                    additionalProperties:
                      type: object
                      description: æŸä¸ªåˆ†ç±»çš„ä¸‹è½½ä¿¡æ¯
                      additionalProperties:
                        type: object
                        required:
                          - title
                          - url
                        properties:
                          title:
                            type: string
                            description: ä¸‹è½½æ ‡é¢˜
                            example: Windows å®‰è£…ç¨‹åº
                          url:
                            type: string
                            description: ä¸‹è½½é“¾æ¥
                            example: https://getfrp.sh/l/SakuraLauncher.exe
                          url_real:
                            type: string
                            description: æ— é‡å®šå‘çš„çœŸå®ä¸‹è½½é“¾æ¥
                            example: https://nyat-static.globalslb.net/natfrp/client\/2.0.6.0/SakuraLauncher.exe
                          hash:
                            type: string
                            description: ä¸‹è½½æ–‡ä»¶å“ˆå¸Œå€¼
                            example: 1234567890abcdef1234567890abcdef
                          size:
                            type: integer
                            description: ä¸‹è½½æ–‡ä»¶å¤§å°
                            example: 114514
          description: è¿”å›è½¯ä»¶ä¸‹è½½ä¿¡æ¯
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /system/policy:
    get:
      tags: [ç³»ç»Ÿä¿¡æ¯]
      summary: è·å–æœåŠ¡æ¡æ¬¾å’Œç­–ç•¥
      security: []
      parameters:
        - name: type
          in: query
          description: ç­–ç•¥ç±»å‹
          required: true
          schema:
            type: string
            enum:
              - tos
              - content
              - privacy
              - rule
              - refund
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                required:
                  - content
                properties:
                  alert:
                    type: string
                    description: ç½®é¡¶è­¦å‘Šæ¡†å†…å®¹
                    example: Habitasse platea dictumst vestibulum rhoncus est pellentesque elit
                  updated:
                    type: string
                    description: ç­–ç•¥æ›´æ–°æ—¶é—´
                    example: 2023/01/04
                  content:
                    type: string
                    description: ç­–ç•¥å†…å®¹æ–‡æœ¬
                    example: Nam at lectus urna duis. Sed pulvinar proin gravida hendrerit. Nec feugiat nisl pretium fusce id velit ut tortor pretium.
          description: è¿”å›æœåŠ¡æ¡æ¬¾å’Œç­–ç•¥
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /user/info:
    get:
      tags: [ç”¨æˆ·ä¿¡æ¯]
      summary: è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: ./schemas/UserInfo.yaml
          description: è¿”å›ç”¨æˆ·ä¿¡æ¯
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /nodes:
    get:
      tags: [èŠ‚ç‚¹ç®¡ç†]
      summary: åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  required:
                    - name
                    - host
                    - description
                    - vip
                    - flag
                    - band
                    - enforce_auth
                    - tls_sucks
                  properties:
                    name:
                      type: string
                      description: èŠ‚ç‚¹åç§°
                      example: ä¸€ä¸ªç¥å¥‡çš„èŠ‚ç‚¹
                    host:
                      type: string
                      description: èŠ‚ç‚¹åœ°å€
                      example: idea-leaper-1.natfrp.cloud
                    description:
                      type: string
                      description: èŠ‚ç‚¹è¯´æ˜
                      example: æ¨èæŸäº›ç”¨æˆ·ä½¿ç”¨
                    vip:
                      type: integer
                      description: èŠ‚ç‚¹ VIP ç­‰çº§
                    flag:
                      type: integer
                      description: |
                        èŠ‚ç‚¹ Flag
                        - `0b11`: å…è®¸ HTTP éš§é“
                        - `1 << 2`: å…è®¸åˆ›å»ºéš§é“
                        - `1 << 3`: æ˜¯å¦ä¸ºå†…åœ°èŠ‚ç‚¹
                        - `1 << 4`: æ˜¯å¦ä¸ºæ— é˜²èŠ‚ç‚¹
                        - `1 << 5`: å…è®¸ UDP æµé‡
                      example: 0
                    band:
                      type: string
                      description: èŠ‚ç‚¹å¸¦å®½
                      example: 100M
                    enforce_auth:
                      type: boolean
                      description: å¼ºåˆ¶å¯ç”¨è®¿é—®è®¤è¯
                      example: false
                    tls_sucks:
                      type: boolean
                      description: æœºæˆ¿å±è”½ TLS æµé‡
                      example: false
          description: èŠ‚ç‚¹åˆ—è¡¨
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnels:
    get:
      tags: [éš§é“ç®¡ç†]
      summary: åˆ—å‡ºæ‰€æœ‰éš§é“
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ./schemas/TunnelFull.yaml
          description: éš§é“åˆ—è¡¨
        "500": { $ref: "#/components/responses/ErrorResponse" }
    post:
      tags: [éš§é“ç®¡ç†]
      summary: åˆ›å»ºéš§é“
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelCreateRequestBody
            schema:
              $ref: ./schemas/TunnelFull.yaml
          application/json: *tunnelCreateRequestBody
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                  - name
                properties:
                  id:
                    type: integer
                    description: åˆ›å»ºçš„éš§é“ ID
                    example: 114514
                  name:
                    type: string
                    description: åˆ›å»ºçš„éš§é“å
                    example: SampleTunnel
                  remote:
                    description: è¿œç¨‹ä¿¡æ¯
                    oneOf:
                      - description: "è¿œç¨‹ç«¯å£"
                        type: integer
                        example: 114455
                      - description: "ç»‘å®šåŸŸå"
                        type: string
                        example: "www.example.com"
          description: åˆ›å»ºæˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/config:
    post:
      summary: è·å–éš§é“é…ç½®æ–‡ä»¶
      tags: [éš§é“ç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelConfigRequestBody
            schema:
              type: object
              properties:
                query:
                  description: |
                    å¯åŠ¨ç›®æ ‡æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸º `<å¯åŠ¨ç›®æ ‡1>[,å¯åŠ¨ç›®æ ‡2...]`

                    å¤šä¸ª **å¯åŠ¨ç›®æ ‡** ä½¿ç”¨åŠè§’é€—å· "," åˆ†å¼€ï¼Œä¸­é—´ä¸èƒ½æœ‰ç©ºæ ¼æˆ–å…¶ä»–å­—ç¬¦

                    æ¯ä¸ª **å¯åŠ¨ç›®æ ‡** å¯ä»¥æ˜¯ï¼š
                    - ä¸€ä¸ªéš§é“ IDï¼ˆå¦‚ `114514`ï¼‰
                    - `n` å‰ç¼€çš„èŠ‚ç‚¹ IDï¼ˆå¦‚ `n233`ï¼‰
                  type: string
                  example: "114514,114515,n233"
            examples:
              æŸ¥è¯¢å•æ¡éš§é“:
                value:
                  query: "114514"
              æŸ¥è¯¢å•ä¸ªèŠ‚ç‚¹ä¸‹æ‰€æœ‰éš§é“:
                value:
                  query: n233
              æŸ¥è¯¢å¤šèŠ‚ç‚¹ä¸‹çš„å¤šæ¡éš§é“:
                value:
                  query: "n233,n234,114514"
          application/json: *tunnelConfigRequestBody

      responses:
        "200":
          content:
            text/plain: {}
          description: å¯è¢« frpc åŠ è½½çš„ ini é…ç½®æ–‡ä»¶
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/edit:
    post:
      summary: ç¼–è¾‘éš§é“
      tags: [éš§é“ç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelEditRequestBody
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: éš§é“ ID
                  example: 114514
                note:
                  type: string
                  description: éš§é“å¤‡æ³¨
                  example: SampleTunnel
                local_ip:
                  type: string
                  description: æœ¬åœ° IP
                  example: 127.0.0.1
                local_port:
                  type: integer
                  description: æœ¬åœ°ç«¯å£
                  example: 114514
                extra:
                  type: string
                  description: é¢å¤–å‚æ•°åˆ—è¡¨
                  example: "key=value\nkey2=value2"
          application/json: *tunnelEditRequestBody
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                required:
                  - extra
                properties:
                  extra:
                    type: string
                    description: å¤„ç†åçš„é¢å¤–å‚æ•°åˆ—è¡¨
                    example: "key=value\nkey2=value2"
          description: æœåŠ¡ç«¯å¤„ç†åçš„å‚æ•°
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/migrate:
    post:
      summary: è¿ç§»éš§é“
      tags: [éš§é“ç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelMigrateRequestBody
            schema:
              type: object
              required:
                - id
                - node
              properties:
                id:
                  type: integer
                  description: éš§é“ ID
                  example: 114514
                node:
                  type: integer
                  description: ç›®æ ‡èŠ‚ç‚¹ ID
                  example: 233
          application/json: *tunnelMigrateRequestBody
      responses:
        "204":
          description: è¿ç§»æˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/delete:
    post:
      summary: åˆ é™¤éš§é“
      tags: [éš§é“ç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &deleteTunnelRequestBody
            schema:
              type: object
              properties:
                ids:
                  description: ä»¥ `,` åˆ†éš”çš„éš§é“ ID åˆ—è¡¨ï¼Œæœ€å¤§æ”¯æŒ 10 æ¡éš§é“
                  type: string
                  example: 114514,1919,810
          application/json: *deleteTunnelRequestBody
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                required:
                  - deleted
                  - failed
                properties:
                  deleted:
                    type: array
                    items:
                      type: integer
                    description: è¢«åˆ é™¤çš„éš§é“ ID åˆ—è¡¨
                    example:
                      - 114514
                      - 114515
                  failed:
                    type: array
                    items:
                      type: integer
                    description: å·²åˆ é™¤ä½†æœªèƒ½æˆåŠŸè¸¢ä¸‹çº¿çš„éš§é“ ID åˆ—è¡¨
                    example:
                      - 1919
          description: åˆ é™¤æˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/traffic:
    get:
      summary: è·å–æµé‡ä½¿ç”¨è®°å½•
      tags: [éš§é“ç®¡ç†]
      parameters:
        - name: id
          in: query
          description: éš§é“ ID
          required: true
          schema:
            type: integer
            description: éš§é“ ID
            example: 114514
      description: è¿”å› `Timestamp[Traffic]`
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer
          description: éš§é“æµé‡å†å²è®°å½•
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/auth:
    post:
      summary: æˆæƒ IP è®¿é—®éš§é“
      tags: [éš§é“ç®¡ç†, è®¿é—®è®¤è¯]
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelAuthRequestBody
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  description: éš§é“ ID
                  type: integer
                  example: 114514
                ip:
                  description: è¦æˆæƒçš„ IPï¼Œç•™ç©ºæˆæƒè¯·æ±‚ IP
                  type: string
                  example: "114.51.4.191"
          application/json: *tunnelAuthRequestBody
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                required:
                  - ip
                properties:
                  ip:
                    type: string
                    description: æˆæƒæˆåŠŸçš„ IP
                    example: "114.51.4.191"
          description: æˆæƒæˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /tunnel/auth_query:
    post:
      summary: æ ¹æ®èŠ‚ç‚¹ IP å’Œç«¯å£æŸ¥è¯¢éš§é“ï¼Œç”¨äºè®¿é—®è®¤è¯æˆæƒ
      tags: [éš§é“ç®¡ç†, è®¿é—®è®¤è¯]
      requestBody:
        content:
          application/www-form-urlencoded: &tunnelRemoteQueryRequestBody
            schema:
              type: object
              required:
                - ip
                - port
              properties:
                ip:
                  description: èŠ‚ç‚¹ IP
                  type: string
                  example: "114.51.4.191"
                port:
                  description: éš§é“è¿œç¨‹ç«¯å£
                  type: integer
                  example: 114514
          application/json: *tunnelRemoteQueryRequestBody
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                  - name
                properties:
                  id:
                    type: integer
                    description: éš§é“ ID
                    example: 114514
                  name:
                    type: string
                    description: éš§é“å
                    example: SampleTunnel
          description: æŸ¥è¯¢åˆ°çš„éš§é“ä¿¡æ¯
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /computers:
    get:
      summary: è·å–è®¡ç®—æœºåˆ—è¡¨
      tags: [è®¡ç®—æœºç®¡ç†]
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: ./schemas/ComputerWithId.yaml
          description: è®¡ç®—æœºåˆ—è¡¨
        "500": { $ref: "#/components/responses/ErrorResponse" }
    post:
      summary: æ·»åŠ è®¡ç®—æœº
      tags: [è®¡ç®—æœºç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &addComputerRequestBody
            schema:
              $ref: ./schemas/Computer.yaml
          application/json: *addComputerRequestBody
      responses:
        "201":
          content:
            application/json:
              schema:
                type: object
                required:
                  - id
                properties:
                  id:
                    type: integer
                    description: è®¡ç®—æœº ID
                    example: 114514
          description: åˆ›å»ºæˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }
    patch:
      summary: æ›´æ–°è®¡ç®—æœºä¿¡æ¯
      tags: [è®¡ç®—æœºç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &updateComputersRequestBody
            schema:
              $ref: ./schemas/ComputerWithId.yaml
          application/json: *updateComputersRequestBody
      responses:
        "204":
          description: æ›´æ–°æˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /computer/delete:
    post:
      summary: åˆ é™¤è®¡ç®—æœº
      tags: [è®¡ç®—æœºç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &deleteComputerRequestBody
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: è®¡ç®—æœº ID
                  example: 1001
          application/json: *deleteComputerRequestBody
      responses:
        "204":
          description: åˆ é™¤æˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

  /computer/poweron:
    post:
      summary: æ‰§è¡Œè¿œç¨‹å¼€æœº
      tags: [è®¡ç®—æœºç®¡ç†]
      requestBody:
        content:
          application/www-form-urlencoded: &powerOnRequestBody
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: integer
                  description: è®¡ç®—æœº ID
                  example: 1001
                password:
                  type: string
                  description: è¿œç¨‹å¼€æœºå®¢æˆ·ç«¯å¯†ç 
                  example: "wdnmdpassword"
          application/json: *powerOnRequestBody
      responses:
        "204":
          description: å¼€æœºæˆåŠŸ
        "500": { $ref: "#/components/responses/ErrorResponse" }

components:
  responses:
    ErrorResponse:
      content:
        application/json:
          schema:
            type: object
            required:
              - code
              - msg
            properties:
              code:
                description: é”™è¯¯ä»£ç 
                type: integer
                example: 403
              msg:
                description: äººç±»å‹å¥½çš„é”™è¯¯ä¿¡æ¯
                type: string
                example: æ— æƒè®¿é—®
      description: é€šç”¨é”™è¯¯è¿”å›

  securitySchemes:
    PanelSessionCookie:
      type: apiKey
      description: ä¸»ç«™ PHP Session è®¤è¯
      name: PHPSESSID
      in: cookie
    UserToken:
      scheme: bearer
      type: http
      description: è®¿é—®å¯†é’¥è®¤è¯ - Bearer Token
    UserTokenPost:
      type: apiKey
      description: è®¿é—®å¯†é’¥è®¤è¯ - POST å‚æ•°
      name: token
      in: query

security:
  - UserToken: []
  - UserTokenPost: []
  - PanelSessionCookie: []
